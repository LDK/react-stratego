(this["webpackJsonpreact-stratego"]=this["webpackJsonpreact-stratego"]||[]).push([[0],{51:function(e,t,a){},52:function(e,t,a){},70:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(39),i=a.n(r),s=(a(51),a(4)),o=(a(52),a(53),a(20)),d=a(3),u=a(13),l=a(12),j=a(1);function h(e){var t=Object(u.c)(),a=t.authState,c=t.oktaAuth,r=e.app,i=r.userInfo,s=r.setUserInfo,o=r.unregistered,d=r.setUnregistered,l=r.checkAuth;if(Object(n.useEffect)((function(){return l({authState:a,oktaAuth:c,userInfo:i,setUserInfo:s,setUnregistered:d})}),[a,c]),!a)return Object(j.jsx)("div",{children:"Loading authentication..."});var h=function(){return c.signInWithRedirect({originalUri:"/"})},b=function(){return a.isAuthenticated?null:Object(j.jsx)("div",{children:Object(j.jsx)("button",{onClick:h,children:"Login"})})},O="",p="",f="",g=function(e,t,a){return Object(j.jsxs)("div",{id:t,children:[Object(j.jsx)("h3",{children:a}),Object(j.jsx)("ul",{children:e.map((function(e){return Object(j.jsx)("li",{children:Object(j.jsx)("a",{href:"/game/"+e.id,children:e.title})},"game-".concat(t,"-").concat(e.id))}))})]})};return a.isAuthenticated?o?O=Object(j.jsx)("div",{children:Object(j.jsx)("p",{children:"If you are seeing this, I should really open a modal to create your profile, new user."})}):i?(O=Object(j.jsxs)("div",{children:[Object(j.jsxs)("p",{children:["Welcome, ",i.username,"!"]}),Object(j.jsx)("button",{onClick:function(){c.signOut()},children:"Logout"})]}),i.recent_games&&(p=g(i.recent_games,"recent-games","Recent Games")),i.active_games&&(f=g(i.active_games,"active-games","Active Games"))):O=Object(j.jsx)("div",{children:Object(j.jsx)("p",{children:"Loading user info..."})}):O=Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"You need to sign in to use the application!"}),Object(j.jsx)(b,{})]}),Object(j.jsxs)("div",{className:"page-home",children:[Object(j.jsx)("h1",{children:"Welcome to Stratego"}),O,f,p]})}var b=a(43),O=a(36),p=a(44),f=a(76),g=function(e){var t=e.rank,a=e.color,n=e.squareId,c=Object(f.a)({type:"GamePiece",item:{rank:t,color:a,squareId:n},collect:function(e){return{isDragging:e.isDragging()}}}),r=Object(s.a)(c,2),i=r[0].isDragging,o=r[1];return Object(j.jsxs)("div",{className:"game-piece",ref:o,"data-rank":t,"data-color":a,"data-square":n,children:[a||""," ",t&&a?t||"?":"",i&&"\ud83d\ude31"]})},m=a(75),x=a(45),v=a(77),k=[43,44,47,48,53,54,57,58],S=function(e){var t,a,n=e.x,c=e.y,r=e.id,i=(e.data,Object(v.a)({accept:"GamePiece",drop:function(e){console.log("dropped",e,"on",r)},collect:function(e){return{isOver:e.isOver()}}})),o=Object(s.a)(i,2),d=(o[0].isOver,o[1]);return k.includes(r)?Object(j.jsx)(O.a,{className:"game-space unpassable text-center","data-x":n,"data-y":c,"data-id":r,"data-passable":!1,children:"X"}):(e.data&&(t=e.data.rank,a=e.data.color),Object(j.jsx)(O.a,{className:"game-space","data-x":n,"data-y":c,"data-id":r,ref:d,children:Object(j.jsx)(g,{rank:t,color:a,squareId:r})}))},y=function(e){for(var t=e.y,a=e.spaces,n=1,c=[];n<=10;){var r=10*(t-1)+n;c.push(Object(j.jsx)(S,{y:t,x:n,id:r,data:a[r]},r)),n++}return Object(j.jsx)(b.a,{className:"board-row",children:c})},I=function(e){if(!e||!e.data)return null;var t=[],a={};e.data.spaces&&(a=JSON.parse(e.data.spaces));for(var n=1;n<=10;)t.push(Object(j.jsx)(y,{spaces:a,y:n},"row-"+n)),n++;return Object(j.jsxs)(p.a,{className:"game-board",children:[Object(j.jsxs)("p",{children:["game board, last checked ",e.lastChecked]}),Object(j.jsx)(m.a,{backend:x.a,children:t})]})};function w(e){var t=Object(d.e)().game_id,a=Object(u.c)(),c=a.authState,r=a.oktaAuth,i=e.app,o=i.userInfo,l=i.setUserInfo,h=i.unregistered,b=i.setUnregistered,O=i.checkAuth,p=Object(n.useState)(!1),f=Object(s.a)(p,2),g=f[0],m=f[1],x=Object(n.useState)(!1),v=Object(s.a)(x,2),k=v[0],S=v[1],y=Object(n.useState)(null),w=Object(s.a)(y,2),_=w[0],U=w[1],A=Object(n.useState)(null),N=Object(s.a)(A,2),C=N[0],L=N[1],G=Object(n.useState)(null),T=Object(s.a)(G,2),q=T[0],D=T[1],P=Object(n.useState)(null),J=Object(s.a)(P,2),Y=J[0],F=J[1],R=Object(n.useState)(null),B=Object(s.a)(R,2),E=B[0],K=B[1],W=Object(n.useState)(Date.now()),H=Object(s.a)(W,2),M=H[0],Q=H[1],X=Object(n.useState)(null),z=Object(s.a)(X,2),V=z[0],Z=z[1],$=Object(n.useState)(!1),ee=Object(s.a)($,2),te=ee[0],ae=ee[1];if(Object(n.useEffect)((function(){return O({authState:c,oktaAuth:r,userInfo:o,setUserInfo:l,setUnregistered:b})}),[c,r]),!c)return Object(j.jsx)("div",{children:"Loading authentication..."});if(te)return Object(j.jsx)("div",{children:"Sorry, no game was found with that id."});if(c.isAuthenticated){if(h)return Object(j.jsx)("div",{children:Object(j.jsx)("p",{children:"If you are seeing this, I should really open a modal to create your profile, new user."})});if(o){g||k||function(e,t){if(!g){S(!0);var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,userKey:t.key,user_id:t.id})};fetch("http://localhost:3002/game",a).then((function(e){e.ok?e.json().then((function(e){m(!0),S(!1),U(e.turn),L(e.starter_uid==t.id?"blue":"red"),D(e.starter_uid==t.id?e.opponent_name:e.starter_name),K(e.starter_name),F(e.opponent_name),Q(Date.now()),Z(e)})):ae(!0)}))}}(t,o);var ne="";return _&&(ne=Object(j.jsxs)("p",{children:["red"==_?Y:E,"'s turn."]})),Object(j.jsxs)("div",{className:"game-wrapper",children:["Game: ",t,". You are ",o.username,". Your opponent is ",q,". You use ",C," tiles.",ne,Object(j.jsx)(I,{data:V,lastChecked:M,color:C,turn:_})]})}return Object(j.jsx)("div",{children:Object(j.jsx)("p",{children:"Loading..."})})}return window.location="/",Object(j.jsx)("div",{children:Object(j.jsx)("p",{children:"You need to sign in to use the application!"})})}var _="dev-6379228.okta.com",U={clientId:"".concat("0oa2t6lqn7Qsg1T3g5d7"),issuer:"https://".concat(_,"/oauth2/default"),discoveryUri:"https://".concat(_,"/oauth2/default"),redirectUri:"http://localhost:3000/login-callback",endSessionRedirectUri:"http://localhost:3000/logout",scopes:["openid","profile","email"],requireHardwareBackedKeyStore:!1,pkce:!0},A=new l.OktaAuth(U),N=Object(l.toRelativeUrl)(window.location.href,window.location.origin);A.setOriginalUri(N);var C=function(){return Object(j.jsxs)("header",{children:[Object(j.jsx)("div",{children:"Stratego"}),Object(j.jsx)("ul",{className:"menu",children:Object(j.jsx)("li",{children:Object(j.jsx)(o.b,{to:"/",children:"Home"})})})]})},L=function(){var e=Object(n.useState)(null),t=Object(s.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(!1),i=Object(s.a)(r,2),l={userInfo:a,setUserInfo:c,unregistered:i[0],setUnregistered:i[1],checkAuth:function(e){var t=e.authState,a=e.oktaAuth,n=e.userInfo,c=e.setUserInfo,r=e.setUnregistered;t&&t.isAuthenticated?n&&n.username||a.token.getUserInfo().then((function(e){var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userKey:e.sub,email:e.email})};fetch("http://localhost:3002/login",t).then((function(e){return e.json()})).then((function(t){c({email:t.email,id:t.user_id,key:e.sub,invite_available:t.invite_available,random_available:t.random_available,username:t.username,recent_games:t.recentGames,active_games:t.activeGames}),r(!t.user_id)}))})):c(null)}};return Object(j.jsx)("div",{className:"App",children:Object(j.jsxs)(o.a,{children:[Object(j.jsx)(C,{}),Object(j.jsxs)(u.b,{oktaAuth:A,restoreOriginalUri:function(){window.location="/"},children:[Object(j.jsx)(d.a,{exact:!0,path:"/",children:Object(j.jsx)(h,{app:l})}),Object(j.jsx)(d.a,{path:"/game/:game_id",children:Object(j.jsx)(w,{app:l})}),Object(j.jsx)(d.a,{path:"/login-callback",component:u.a})]})]})})},G=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,78)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),r(e),i(e)}))};i.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(L,{})}),document.getElementById("root")),G()}},[[70,1,2]]]);
//# sourceMappingURL=main.5124a1b4.chunk.js.map