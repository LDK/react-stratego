(self.webpackChunkreact_stratego=self.webpackChunkreact_stratego||[]).push([[167,27],{5181:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(7294),n=r(5697),o=r.n(n),s=r(361),i=r.n(s);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(h,e);var t,r,n,s,l,m=(s=h,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(s);if(l){var r=f(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return u(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=m.call(this,e)).callback=t.callback.bind(d(t)),t.afterCallback=t.afterCallback.bind(d(t)),t.renderSelect=t.renderSelect.bind(d(t)),t.renderList=t.renderList.bind(d(t)),t.linkList=t.linkList.bind(d(t)),t.state={value:e.value||null,label:e.label||"",items:e.items||[]},e.parentObj&&e.refName?e.parentObj[e.refName]=d(t):e.parentObj&&(e.parentObj.dataBrowser=d(t)),t}return t=h,n=[{key:"propTypes",get:function(){return{value:o().any,id:o().string,view:o().string,label:o().string,labelClass:o().string,className:o().string,items:o().array,links:o().array,parentObj:o().object,refName:o().string,beforeText:o().string,callback:o().func,afterCallback:o().func,afterArgKey:o().any,onSelect:o().func,emptyOption:o().string,deleteEmpty:o().bool,afterLinks:o().array,afterKeys:o().object,afterKeysSep:o().string,afterParentheses:o().bool,beforeLinks:o().bool,hideIfEmpty:o().bool,disabled:o().bool,emptyVal:o().any,additionalClasses:o().string}}}],(r=[{key:"callback",value:function(e){var t;t=e.target.hasAttribute("data-key")?e.target.getAttribute("data-key"):e.target.value,this.setState({value:t}),this.props.callback&&this.props.callback(t),this.render()}},{key:"afterCallback",value:function(){}},{key:"renderSelect",value:function(e,t){var r=this,n=this.callback,o=this.props.items;this.props.emptyOption&&(o=i()(this.props.items)).unshift({id:null,name:this.props.emptyOption});var s=o.map((function(e,t){return a.createElement("option",{key:t,value:e.id||r.props.emptyVal||"",onClick:r.props.onSelect||null},e.name)}));return a.createElement("div",{className:t},a.createElement("label",{className:this.props.labelClass},this.state.label),a.createElement("select",{onChange:n,id:e,value:this.state.value||""},s))}},{key:"linkList",value:function(e,t,r,n){var o=this.props[e].map((function(e,o){return a.createElement("li",{key:o,className:e.className},a.createElement("a",{className:"anchor underline",onClick:function(){return e.action(e.argKey?r[n][e.argKey]:t)}},e.label))}));return a.createElement("div",{className:"d-inline"},"[",a.createElement("ul",{className:"link-list px-1"},o),"]")}},{key:"renderList",value:function(e,t){var r,n=this,o=this.callback,s=this.props.items;if(this.props.deleteEmpty)for(var i in s)s[i].name||delete s[i];if(this.props.afterLinks)r=s.map((function(e,t){return a.createElement("li",{key:t},e.name," ",n.linkList("afterLinks",e.id,s,t))}));else if(this.props.beforeLinks)r=s.map((function(e,t){return a.createElement("li",{key:t},e.name," ",n.linkList("beforeLinks",e.id))}));else if(this.props.beforeText)r=s.map((function(e,t){return a.createElement("li",{key:t},n.props.beforeText," ",e.name)}));else{var l=null;for(var c in r=[],s){var p=s[c];if(p.buttons){var u=p.buttons.map((function(e,t){return a.createElement("li",{key:t,className:"mr-3 py-2"},a.createElement("a",{className:"button","data-type":e.type||"undefined","data-mode":e.mode||"undefined","data-id":e.id||"null",onClick:e.action},e.label))}));l=a.createElement("div",{"data-key":p.id},a.createElement("span",null,p.name),a.createElement("ul",{className:"item-buttons"},u))}else{var d="";if(this.props.afterKeys){var f=this.props.afterKeysSep||",",m=0;for(var h in this.props.afterKeys)p[h]&&(m&&(d+=f+" "),m++,d+=this.props.afterKeys[h].replace("%this%",p[h])+" "),d=d.trim();if(d.length){var y="",b="";this.props.afterParentheses&&(y="(",b=")"),d=" "+y+d+b}}l=a.createElement("a",{onClick:p.onSelect||o,className:"anchor underline","data-key":p.id},p.name),this.props.afterCallback&&(d=a.createElement("a",{className:"anchor",onClick:function(){return n.props.afterCallback(p[n.props.afterArgKey||h])}},d))}r.push(a.createElement("li",{key:c,className:p.className},l,d))}}return a.createElement("div",{className:t,id:this.props.id||null},a.createElement("label",{className:this.props.labelClass},this.state.label),a.createElement("ul",{id:e},r))}},{key:"render",value:function(){var e,t=this.props.view||"list",r="dataBrowser"+(this.props.disabled?" disabled ":" ")+(this.props.className||""),a=this.props.id||"";if(this.props.hideIfEmpty&&(!this.props.items||!this.props.items.length))return null;switch(t){case"select":e=this.renderSelect(a,r);break;case"list":default:e=this.renderList(a,r)}return e}}])&&c(t.prototype,r),n&&c(t,n),h}(a.Component)},7540:(e,t,r)=>{"use strict";r.d(t,{Z:()=>f});var a=r(7294),n=r(5697),o=r.n(n),s=r(6347);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(h,e);var t,r,n,i,f,m=(i=h,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(i);if(f){var r=d(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return p(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=m.call(this,e)).onKeyDown=t.onKeyDown.bind(u(t)),t.closeForm=t.closeForm.bind(u(t)),t}return t=h,n=[{key:"propTypes",get:function(){return{parentMenu:o().object,content:o().any,styles:o().object,height:o().string,width:o().string,additionalClasses:o().string}}}],(r=[{key:"closeForm",value:function(){this.props.parentMenu.closeForm?this.props.parentMenu.closeForm():this.props.parentMenu.setState({formOpen:!1})}},{key:"onKeyDown",value:function(e){if(e.keyCode)switch(e.keyCode){case this.props.parentMenu.props.app.Config.KeyCodes.esc:this.closeForm()}}},{key:"render",value:function(){var e=this.props,t=e.content,r=e.parentMenu.props.app,n={};return e.styles&&(n=e.styles),a.createElement(s.Z,{id:e.parentMenu.id,app:r,content:t,height:e.height||"medium",width:e.width||"medium",open:e.parentMenu.state.formOpen,closeButton:!0,closeCallback:this.closeForm,onKeyDown:this.onKeyDown,styles:n,additionalClasses:"p-md-5 "+e.additionalClasses||0})}}])&&l(t.prototype,r),n&&l(t,n),h}(a.Component)},6347:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var a=r(7294),n=r(5697),o=r.n(n);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(m,e);var t,r,n,s,d,f=(s=m,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(s);if(d){var r=u(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return c(this,e)});function m(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=f.call(this,e)).state={},t.onKeyDown=t.onKeyDown.bind(p(t)),e.app.activeModal=p(t),t}return t=m,n=[{key:"propTypes",get:function(){return{app:o().object,open:o().bool,onKeyDown:o().func,closeButton:o().any,content:o().element,closeCallback:o().func,styles:o().object,height:o().string,width:o().string,additionalClasses:o().string,id:o().any}}}],(r=[{key:"onKeyDown",value:function(e){if(this.props.onKeyDown)return this.props.onKeyDown(e)}},{key:"componentDidMount",value:function(){this.modalContainer.focus()}},{key:"componentWillUnmount",value:function(){this.props.app.activeModal=null}},{key:"render",value:function(){var e=this,t=this.props.content,r=this.props,n=r.additionalClasses+" modal-wrapper";r.height&&(n+=" height-"+r.height),r.width&&(n+=" width-"+r.width);var o="";r.closeButton&&(o=a.createElement("a",{className:"close-button button",onClick:r.closeCallback},"X"));var s={};return r.styles&&(s=r.styles),a.createElement("section",{id:r.id||null,ref:function(t){e.modalContainer=t},className:"modal-container "+(r.open?" open":""),onKeyDown:this.onKeyDown},a.createElement("div",{className:"modal-overlay"}),a.createElement("div",{className:n,style:s},o,t))}}])&&i(t.prototype,r),n&&i(t,n),m}(a.Component)},900:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>$});var a=r(7294),n=r(5697),o=r.n(n),s=(r(7147),r(5975)),i=r(8035);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(f,e);var t,r,n,s,i,l=(s=f,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(s);if(i){var r=d(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return u(this,e)});function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=l.call(this,e)).passable=t.props.passable||!0,t.x=e.x,t.y=e.y,t.state={extraClass:""},t}return t=f,n=[{key:"propTypes",get:function(){return{passable:o().bool,x:o().number,y:o().number,territory:o().string,spaceKey:o().any,id:o().number,children:o().element}}}],(r=[{key:"render",value:function(){return a.createElement("div",{id:"gameSpace-"+this.props.id,"data-col":this.props.x,"data-row":this.props.y,"data-territory":this.props.territory,className:"gameSpace col "+(this.props.spaceKey||"")+(this.props.passable?" passable":"")+" "+this.state.extraClass},this.props.children)}}])&&c(t.prototype,r),n&&c(t,n),f}(a.Component);function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function h(e){var t,r,n=e.id,o=e.x,l=e.y,c=e.passable,p=e.board,u=e.game,d=e.children,h=e.occupied,y=function(e,t,r,a,n){if(!a||!n||!n.state)return!1;if(!c)return!1;if(n.state.started){var o=n.props.app.Config.Pieces[a.rank],i=p.getValidMoveSpaces(a.fromX,a.fromY,a.color,o,n),l=(0,s.Ly)(e,t);return l&&-1!=i.indexOf(l)}return a.color==r},b=l<5?"red":l>6?"blue":"neutral",v=(t=(0,i.L)({accept:"piece",drop:function(){return function(e,t,r,a){u&&u.state&&(u.state.started||a.color==r)&&c&&"done"!=u.state.status&&(a.gameSpaceId=n,p.placePiece(a,n,!1))}(0,0,b,k)},canDrop:function(){return y(o,l,b,k,u)},collect:function(e){return{dropped:e.getItem(),isOver:e.isOver(),canDrop:e.canDrop()}}}),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var a,n,o=[],s=!0,i=!1;try{for(r=r.call(e);!(s=(a=r.next()).done)&&(o.push(a.value),!t||o.length!==t);s=!0);}catch(e){i=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(i)throw n}}return o}}(t,r)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),g=v[0],k=g.dropped,S=g.isOver,w=g.canDrop,O=v[1],_="";k&&(_=w&&S?"drop-target":w&&u.state.started?"droppable":"no-drop");var C=parseInt(u.props.app.state.currentUser.user_id)==parseInt(u.props.starter)?"blue":"red",E="",x="",R=void 0!==h&&R?" occupied":"";if(p.state.selectedSpace){var P=p.state.spaces[p.state.selectedSpace].props.children,B={};P&&(B={type:"piece",rank:P.props.rank||null,game:u,color:P.props.color,tileSpace:!1,fromX:P.props.fromX,fromY:P.props.fromY,fromId:P.props.fromId},y(o,l,b,B,u)&&(_="droppable"))}p.state.selectedSpace&&p.state.selectedSpace==n&&(E=" selectedSpace"),p.state.highlighted&&p.state.highlighted==n&&(x=" highlightedSpace");var M=c?" passable":" not-passable";return a.createElement("div",{ref:O,className:"gameSpace-wrapper col px-0 mx-0 "+_+E+x+M+R,onClick:function(){var e;if(u&&u.state&&(u.state.started||C==b)&&c&&"done"!=u.state.status)if(u.state.started||"click"!=u.state.placementMode)if(u.state.started||"keyboard"!=u.state.placementMode){if(u.state.started&&p.state.selectedSpace){var t={type:"piece",rank:(e=p.state.spaces[p.state.selectedSpace].props.children).props.rank||null,game:u,color:e.props.color,tileSpace:void 0,fromX:e.props.fromX,fromY:e.props.fromY,fromId:e.props.fromId};y(o,l,b,t,u)&&(t.gameSpaceId=n,p.placePiece(t,n,!1))}}else p.selectSpace(n);else{void 0===d&&p.state.selectedSpace&&b==C&&(p.swapPieces(p.state.selectedSpace,n),p.highlightSpace(null),p.selectSpace(null),u.resetHelpText());var r=u.selectedRank,a=u.props.app.tileSpaces[r];if(!r||!a)return;b==C&&(e={rank:r,color:C,tileSpace:a,gameSpaceId:n},p.placePiece(e,n,!1))}}},a.createElement(f,{id:n,x:o,y:l,passable:c,territory:b,board:p},d),a.createElement("div",{className:"gameSpace-overlay"}))}h.propTypes={id:o().number,x:o().number,y:o().number,passable:o().bool,board:o().object,game:o().object,children:o().element,occupied:o().bool};const y=h;var b=r(6270),v=r(6347),g=r(361),k=r.n(g),S=r(7540),w=r(5181),O=r(4051);function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?R(e):t}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(c,e);var t,r,n,s,i,l=(s=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(s);if(i){var r=P(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return x(this,e)});function c(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=l.call(this,e)).state={selected:null,formOpen:!1},t.selectPreset=t.selectPreset.bind(R(t)),t.handleSubmit=t.handleSubmit.bind(R(t)),e.app.gameBoard.QuickLoadMenu=R(t),t.layoutLookup={},t.previousMode="drag",t.id="quickLoad-modal";var r=e.app.Config.Layouts;for(var a in r)t.layoutLookup[r[a].id]=a;return t}return t=c,n=[{key:"propTypes",get:function(){return{app:o().object,game:o().object}}}],(r=[{key:"handleSubmit",value:function(e){var t=this.props.app,r=this.props.game,a=t.tileRack.playerColor;for(var n in t.gameBoard.clearBoard(),e){var o=e[n],s=parseInt(n)+1;"blue"==a&&(s+=60);var i=t.tileSpaces[o];t.gameBoard.placePiece({rank:o,color:a,tileSpace:i},s,!0)}r.setState({placementMode:this.previousMode}),this.setState({formOpen:!1}),t.saveActiveGame()}},{key:"selectPreset",value:function(e){this.setState({selected:e})}},{key:"render",value:function(){var e=this;if(!this.state.formOpen)return null;var t=this.props,r=t.app,n=t.game,o=r.tileRack,s="";if(this.layoutLookup[this.state.selected]){var i=this.layoutLookup[this.state.selected],l=JSON.parse(r.Config.Layouts[i].value);if("blue"==o.playerColor){var c=l.slice(30,40),p=l.slice(20,30),u=l.slice(10,20),d=l.slice(0,10);l=c.concat(p).concat(u).concat(d)}for(var f=[3,4,7,8],m=[],h=1;h<11;h++){var y="";-1!=f.indexOf(h)&&(y="X"),m.push(a.createElement("div",{className:"preview-square text-center",key:h-11},y))}var v,g=l.map((function(e,t){return a.createElement("div",{className:"preview-square",key:t},a.createElement(b.Z,{app:r,game:n,color:o.playerColor,rank:e,placed:!0,className:""}))}));v="red"==o.playerColor?g.concat(m):m.concat(g),s=a.createElement(O.Z,{noGutters:!0,className:"my-4"},v)}var k=" d-inline-block";this.state.selected||(k=" d-none");var _=a.createElement("div",{id:"presetSelector"},a.createElement("h3",{className:"mt-0"},"QUICK LOAD"),a.createElement(w.default,{label:"Select from Preset Layouts:",items:[{id:null,name:"",value:"[]"}].concat(this.props.app.Config.Layouts),view:"select",id:"presetList",callback:this.selectPreset,labelClass:"d-block mb-2"}),s,a.createElement("a",{className:"text-white text-center go-button blue float-right"+k,tabIndex:"-1",onClick:function(){return e.handleSubmit(l)}},"Load Preset"));return this.state.formOpen?a.createElement(S.Z,{parentMenu:this,height:"auto",content:_,styles:{backgroundColor:"var(--sand)"},additionalClasses:"text-black py-5 px-1"}):null}}])&&C(t.prototype,r),n&&C(t,n),c}(a.Component);var M=r(6698);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?L(e):t}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(p,e);var t,r,n,i,l,c=(i=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=K(i);if(l){var r=K(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return I(this,e)});function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=c.call(this,e)).state={spaces:{},highlighted:null,selectedSpace:null,battleContent:a.createElement(O.Z,null,a.createElement("h3",{className:"col-12 text-center"},"Attacking...")),battleModalOpen:!1},t.droppable={},t.obscuredSpaces={43:!0,44:!0,47:!0,48:!0,53:!0,54:!0,57:!0,58:!0},t.renderGameSpace=t.renderGameSpace.bind(L(t)),t.gameSpaceRow=t.gameSpaceRow.bind(L(t)),t.borderRow=t.borderRow.bind(L(t)),t.gameSpaceRows=t.gameSpaceRows.bind(L(t)),t.placePiece=t.placePiece.bind(L(t)),t.emptySpace=t.emptySpace.bind(L(t)),t.resetSpace=t.resetSpace.bind(L(t)),t.clearDroppables=t.clearDroppables.bind(L(t)),t.swapPieces=t.swapPieces.bind(L(t)),t.swapByKeyboard=t.swapByKeyboard.bind(L(t)),t.checkTilesPlaced=t.checkTilesPlaced.bind(L(t)),t.getValidMoveSpaces=t.getValidMoveSpaces.bind(L(t)),t.highlightSpace=t.highlightSpace.bind(L(t)),t.placementArrowMove=t.placementArrowMove.bind(L(t)),t.openBattleModal=t.openBattleModal.bind(L(t)),t.closeBattleModal=t.closeBattleModal.bind(L(t)),t.getBattleContent=t.getBattleContent.bind(L(t)),t.props.app.gameBoard=L(t),t}return t=p,n=[{key:"propTypes",get:function(){return{app:o().object,game:o().object,refName:o().string,onSelect:o().func,onChange:o().func,suggestions:o().array,inputName:o().string,placeholder:o().string}}}],(r=[{key:"componentDidMount",value:function(){var e=this.props.app;e.gameBoard=this;var t=this.props.game.props.spaces;if(t&&e.tileSpaces)for(var r in t){var a=t[r],n=null;a.rank&&e.tileSpaces[a.rank]&&(n=e.tileSpaces[a.rank]),this.placePiece({rank:a.rank,color:a.color,tileSpace:n},a.id,!0),n&&n.setState({remaining:n.remaining})}}},{key:"componentWillUnmount",value:function(){this.props.app.gameBoard=null}},{key:"clearDroppables",value:function(){for(var e in this.droppable)this.droppable[e]&&(this.droppable[e]=!1,this.resetSpace(e))}},{key:"placementArrowMove",value:function(e){var t=(0,s.PY)(this.state.selectedSpace),r=t.x,a=t.y;switch(e){case 37:r=Math.max(1,r-1);break;case 38:a=Math.max(1,a-1);break;case 39:r=Math.min(10,r+1);break;case 40:a=Math.min(10,a+1)}var n=(0,s.Ly)(r,a);this.selectSpace(n)}},{key:"placeByKeyboard",value:function(e){e=e.toUpperCase();var t=this.props.app,r=parseInt(this.state.selectedSpace||1),a=t.tileRack.playerColor,n=t.tileSpaces[e];this.placePiece({rank:e,color:a,tileSpace:n},r,!1),this.checkTilesPlaced()}},{key:"removeByKeyboard",value:function(){var e=this.props.app,t=this.props.game;e.tileRack.returnTileToRack(t,e),this.checkTilesPlaced()}},{key:"highlightSpace",value:function(e){if("object"==j(e))if(null==e){if(this.state.highlighted)if("object"==j(this.state.highlighted))for(var t in this.state.highlighted)this.resetSpace(this.state.highlighted[t]);else this.resetSpace(this.state.highlighted)}else for(var r in e)this.resetSpace(e[r]);else this.resetSpace(e);this.setState({highlighted:e})}},{key:"highlightByKeyboard",value:function(){var e=parseInt(this.state.selectedSpace||1);this.state.spaces[e]&&this.state.spaces[e].props.children&&this.highlightSpace(e)}},{key:"swapByKeyboard",value:function(e){var t=parseInt(this.state.selectedSpace||1);if(e==t)return this.setState({highlighted:!1}),void this.resetSpace(e);this.swapPieces(e,t),this.highlightSpace(null)}},{key:"selectSpace",value:function(e){var t=this.props.app.tileRack.playerColor,r="red"==t?1:7,a="red"==t?4:10,n=(0,s.Ly)(1,r),o=(0,s.Ly)(10,a),i=parseInt(this.state.selectedSpace||1);!this.props.game.state.started&&e&&e<n?e=Math.max(i,n):e>o&&(e=Math.min(i,o)),this.setState({selectedSpace:e,highlightedSpace:null}),this.resetSpace(e),this.resetSpace(i);var l=Date.now()/1e3;this.props.app.tileRack.setState({rendered:l})}},{key:"openBattleModal",value:function(){this.setState({battleModalOpen:!0})}},{key:"closeBattleModal",value:function(){this.setState({battleModalOpen:!1})}},{key:"getBattleContent",value:function(e){if(!e||!e.attack_rank)return null;var t=this.props.app,r=this.props.game,n=t.Config.Pieces[e.attack_rank].name,o=t.Config.Pieces[e.defend_rank].name,s=t.tileRack.playerColor,i=e.attack_color==s,l=i?n:o,c=e.defeated,p="red"==s?"blue":"red",u=i?o:n,d=parseInt(r.props.starter)==parseInt(t.state.currentUser.user_id)?r.props.opponentName:r.props.starterName,f="",m="",h=k()(r.state.players);h.blue.soldiers=e.remaining.blue,h.red.soldiers=e.remaining.red;var y,v,g="";"both"==c?(r.addCaptured({color:e.attack_color,rank:e.attack_rank}),r.addCaptured({color:e.defend_color,rank:e.defend_rank})):(v=e.attack_color==c?e.attack_rank:e.defend_rank,r.addCaptured({color:c,rank:v})),"Bomb"==o&&(this.emptySpace(e.space_id),this.emptySpace(e.from_space_id)),"both"==c?(this.emptySpace(e.space_id),this.emptySpace(e.from_space_id),r.setState({players:h}),f="Draw!",m=a.createElement("span",null,"Your ",a.createElement("strong",null,l)," and ",a.createElement("strong",{className:"text-opponent-color"},d,"'s")," ",a.createElement("strong",null,u)," defeated each other!")):c==s?(f="Defeat!",y="defeated",r.setState({players:h}),"Bomb"==o&&i?(f="Catastrophe!",y="blown up"):"Bomb"==o?(f="Sabotage!",y="defused"):"Flag"==o&&(f="Defeated!",y="captured"),h[s].soldiers<1&&(f="Defeated!",g=a.createElement("p",{className:"mx-auto text-center"},"Your entire army has been conquered!")),m=a.createElement("span",null,"Your ",a.createElement("strong",null,l)," was ",y," by ",a.createElement("strong",{className:"text-opponent-color"},d,"'s")," ",a.createElement("strong",null,u),"!")):(f="Victory!",r.setState({players:h}),y="defeated","Bomb"==o&&i?(f="Success!",y="defused"):"Bomb"==o?(f="Success!",y="blew up"):"Flag"==o&&(y="captured"),h[p].soldiers<1&&(f="Victory!",g=a.createElement("p",{className:"mx-auto text-center"},a.createElement("strong",{className:"text-opponent-color"},d,"'s")," entire army is defeated!")),m=a.createElement("span",null,"Your ",a.createElement("strong",null,l)," ",y," ",a.createElement("strong",{className:"text-opponent-color"},d,"'s")," ",a.createElement("strong",null,u),"!")),h[s].soldiers<1&&h[p].soldiers<1&&(f="Mutual Destruction!",g=a.createElement("p",{className:"mx-auto text-center"},"Both armies have been entirely depleted! The game is a draw."));var S=a.createElement(O.Z,null,a.createElement("h3",{className:"col-12 text-center battle-heading"},f),a.createElement("p",{className:"col-12 battle-text text-center"},m),g,a.createElement("div",{className:"col-6"},a.createElement(b.Z,{color:e.attack_color,rank:e.attack_rank,placed:!0,className:"float-right"})),a.createElement("div",{className:"col-6"},a.createElement(b.Z,{color:e.defend_color,rank:e.defend_rank,placed:!0,className:""})));this.setState({battleContent:S})}},{key:"renderGameSpace",value:function(e,t,r,n){var o=Boolean(n),s=void 0!==this.selectedSpace&&this.selectedSpace&&this.selectedSpace==r,i=!this.obscuredSpaces[r];return a.createElement(y,{id:r,selected:s,board:this,y:e,x:t,occupied:o,key:r,passable:i,game:this.props.game},n)}},{key:"getValidMoveSpaces",value:function(e,t,r,a,n){var o,i,l=["east","west","south","north"],c=[(0,s.Ly)(e,t)];for(var p in l){var u=l[p];o=!1,i=!1;for(var d=1;d<=a.move&&!o;)if(i)o=!0;else{var f=(0,s.Cz)(e,t,d,u);if(f){var m=n.props.app.gameBoard.state.spaces[f].props;if(m.passable||(o=!0),m.children){if(m.children.props.color==r){o=!0;continue}i=!0}o||c.push(f),d++}else o=!0}}return c}},{key:"emptySpace",value:function(e){var t=this.state.spaces,r=t[e],a=this.renderGameSpace(r.props.y,r.props.x,e);return t[e]=a,this.setState({spaces:t}),a}},{key:"clearBoard",value:function(){var e=this.state.spaces,t=this.props.app,r=t.tileRack.playerColor;for(var a in e){var n=e[a];if(n.props.occupied&&n.props.children&&n.props.children.props.color==r){var o=this.renderGameSpace(n.props.y,n.props.x,a);e[a]=o}}this.setState({spaces:e}),t.tileRack.resetCounts()}},{key:"swapPieces",value:function(e,t){var r=this.props.app,n=this.state.spaces,o=n[t],i=null;void 0!==o.props.children&&(i=o.props.children.props);var l=n[e].props.children.props,c=(0,s.PY)(e),p=(0,s.PY)(t),u=null,d=null;i&&(u=i.fromX,d=i.fromY);var f=a.createElement(b.Z,{color:l.color,rank:l.rank,fromX:u,fromY:d,fromId:t,placed:!0,game:this.props.game}),m=null;i&&(m=a.createElement(b.Z,{color:i.color,rank:i.rank,fromX:l.fromX,fromY:l.fromY,fromId:e,placed:!0,game:this.props.game})),n[t]=this.renderGameSpace(p.y,p.x,t,f),n[e]=this.renderGameSpace(c.y,c.x,e,m||void 0),this.setState({spaces:n}),r.saveActiveGame()}},{key:"checkTilesPlaced",value:function(){var e=this.props.app,t=e.tileRack.playerColor,r=this.state.spaces,a={},n={total:40};for(var o in r){var s=r[o];s.props.children&&t==s.props.children.props.color&&(a[s.props.children.props.rank]?a[s.props.children.props.rank]++:a[s.props.children.props.rank]=1)}for(var i in e.Config.Pieces){var l=e.Config.Pieces[i].count;n[i]=l-(a[i]||0),n.total=n.total-(a[i]||0)}e.tileRack.resetCounts(n)}},{key:"placePiece",value:function(e,t,r){var n=this.state.spaces,o=this.props.app,i=this.props.game,l=!1,c=o.tileRack.playerColor,p=n[t].props,u=p.x,d=p.y,f=e.rank,m=e.color,h=e.tileSpace,y=null;if(u!=e.fromX||d!=e.fromY){if(e.fromId)if(this.props.game.state.started){if(o.isMobile&&this.clearDroppables(),n[t].props.occupied){var v=i.state.attacks+1;l=!0,this.openBattleModal();var g=o.state.currentUser.user_id,k=o.state.currentUser.userKey;if(!g||!k)return[];var S=o.state.activeGame.props.id;n[e.fromId]=this.renderGameSpace(e.fromY,e.fromX,e.fromId);var w={};for(var O in n){var _={};n[O].props.occupied&&n[O].props.children&&(_.id=n[O].props.id,_.rank=n[O].props.children.props.rank,_.color=n[O].props.children.props.color,w[_.id]=_)}var C={game_id:S,spaces:w,user_id:g,userKey:k,from_space_id:e.fromId,space_id:t,attack_rank:f,attack_color:m},E=this;window.fetch(o.gameServer+"battle",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)}).then((function(e){e.text().then((function(e){if(e.length){var t=JSON.parse(e);E.getBattleContent(t),i.setState({attacks:v})}}))}))}else n[e.fromId]=this.renderGameSpace(e.fromY,e.fromX,e.fromId),this.props.game.toggleTurn();i.resetHelpText()}else{if(n[t].props.occupied)return void this.swapPieces(e.fromId,t);n[e.fromId]=this.renderGameSpace(e.fromY,e.fromX,e.fromId)}if(h){if(!h.remaining)return;if(n[t].props.occupied){var x=n[t].props.children.props;if(x.color==m&&x.rank==f)return;x.color==m&&(this.props.app.tileSpaces[x.rank].setState({remaining:this.props.app.tileSpaces[x.rank].remaining+1}),this.props.app.tileSpaces[x.rank].remaining++,h.remaining--)}else m==c&&(h.remaining--,o.tileRack.remaining--,o.tileRack.remaining||o.tileRack.setState({allPlaced:!0}),h.remaining||(i.selectedRank=null,i.resetHelpText()));if(h.setState({remaining:h.remaining}),!h.remaining){i.selectedRank=null;var R=Date.now()/1e3;o.tileRack.setState({rendered:R})}}if(e.fromId){var P=(0,s.MM)(e.fromId,t);y={from:e.fromId,to:t,color:e.color,direction:P.direction,distance:P.distance}}var B=null;i.state.last_move&&t==i.state.last_move.to&&(B=i.state.last_move),n[t]=this.renderGameSpace(d,u,t,a.createElement(b.Z,{color:m,fromX:u,fromY:d,fromId:t,rank:f,placed:!0,moveInfo:B,game:this.props.game}));var M={spaces:n};this.props.game.state.started&&(M.selectedSpace=null,M.highlighted=null),this.setState(M),h&&this.checkTilesPlaced(),r||l||o.saveActiveGame(y)}}},{key:"resetSpace",value:function(e){var t=this.state.spaces,r=t[e];r&&(t[e]=this.renderGameSpace(r.props.y,r.props.x,e,r.props.children),this.setState({spaces:t}))}},{key:"borderRow",value:function(e,t){t||(t=12);for(var r=[],n=1;n<=t;n++)r.push(a.createElement("div",{className:"gameSpace-wrapper border-wrapper col px-0 mx-0",key:e+"-"+n},a.createElement("div",{className:"gameSpace borderSpace",id:e+"-"+n})));return a.createElement("div",{className:"gameSpaceRow borderSpaceRow text-left lg-up",id:e,key:e},r)}},{key:"gameSpaceRow",value:function(e,t,r,n){var o=(e-1)*(n||10),s=[];s.push(a.createElement("div",{className:"gameSpace-wrapper border-wrapper left-wrapper col px-0 mx-0",key:"left-border-"+e},a.createElement("div",{className:"gameSpace borderSpace left-border",id:"left-border-"+e})));for(var i=t;i<=r;i++){var l=null;this.state.spaces[o+i]?l=this.state.spaces[o+i]:(l=this.renderGameSpace(e,i,o+i),this.state.spaces[o+i]=l),s.push(l)}return s.push(a.createElement("div",{className:"gameSpace-wrapper border-wrapper right-wrapper col px-0 mx-0",key:"right-border-"+e},a.createElement("div",{className:"gameSpace borderSpace right-border",id:"right-border-"+e}))),a.createElement("div",{className:"gameSpaceRow text-left",key:e},s)}},{key:"gameSpaceRows",value:function(e,t,r){var a=[];a.push(this.borderRow("top-border"));for(var n=e;n<=t;n++)a.push(this.gameSpaceRow(n,1,r,10));return a.push(this.borderRow("bottom-border")),a}},{key:"render",value:function(){var e=this.props.game,t=this.props.app,r="gameBoard",n=e.state.started&&!t.isMobile?null:a.createElement(M.Z,{game:e,app:t,wrapperClass:"xs-only w-100 d-table mt-1"});return e.state.started||(r+=" placement mode-"+e.state.placementMode),a.createElement("div",{className:r},a.createElement(B,{app:t,game:e}),a.createElement(v.Z,{closeButton:!0,closeCallback:this.closeBattleModal,id:"battle-modal",app:t,content:this.state.battleContent,open:this.state.battleModalOpen,additionalClasses:"p-5 text-black"}),this.gameSpaceRows(1,10,10),n)}}])&&N(t.prototype,r),n&&N(t,n),p}(a.Component);var H=r(4772),G=r(3795),A=r(4289),Y=r(2001),Z=r(9862),X=r(8006),U=r(682),F=r(1555);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e,t){return!t||"object"!==q(t)&&"function"!=typeof t?z(e):t}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const $=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(p,e);var t,r,n,i,l,c=(i=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=W(i);if(l){var r=W(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Q(this,e)});function p(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=c.call(this,e)).state={name:"",id:e.id||!1,players:{blue:{id:e.starter,ready:e.starterReady||!1,name:e.starterName},red:{id:e.opponent||null,ready:e.opponentReady||!1,name:e.opponentName}},captured:{blue:{},red:{}},turn:e.turn||null,placementMode:"click",started:e.started||!1,status:e.status||"pending",attacks:e.attacks||0,winner_uid:e.winner_uid||0,last_move_ts:e.last_move_ts||0,last_attack:e.last_attack||{}},e.app.isMobile?(t.state.placementMode="click",t.placementAction="Tap"):t.placementAction="Click",t.selectedRank=null,t.setHelpText=t.setHelpText.bind(z(t)),t.resetHelpText=t.resetHelpText.bind(z(t)),t.startGame=t.startGame.bind(z(t)),t.modeChange=t.modeChange.bind(z(t)),t.openHelpBar=t.openHelpBar.bind(z(t)),t.closeHelpBar=t.closeHelpBar.bind(z(t)),t.openQuickLoadModal=t.openQuickLoadModal.bind(z(t)),t.addCaptured=t.addCaptured.bind(z(t)),t.clearCaptured=t.clearCaptured.bind(z(t)),t.pollOpponentStatus=t.pollOpponentStatus.bind(z(t)),t.polled=!1,e.captured)for(var r in e.captured){var a=e.captured[r],n=a.split("-")[0],o=a.split("-")[1];t.addCaptured({color:n,rank:o},!0)}return t}return t=p,n=[{key:"propTypes",get:function(){return{app:o().object,id:o().string,starter:o().number,starterReady:o().bool,starterName:o().string,opponent:o().number,opponentReady:o().bool,opponentName:o().string,turn:o().string,started:o().bool,status:o().string,attacks:o().number,winner_uid:o().number,last_move_ts:o().number,last_attack:o().object,captured:o().array}}}],(r=[{key:"setHelpText",value:function(e){var t,r;if("object"==q(e)&&e)e.$$typeof?(t=e,r=!1):(t=e.headline||!1,r=e.subtext||!1);else if("string"==typeof e)t=e,r=!1;else{if(e)return;t=!1,r=!1}this.setState({helpText:t,helpSubtext:r})}},{key:"pollOpponentStatus",value:function(){var e=this.props.app;if(!(e.state.activeGame&&e.state.activeGame.props.id&&e.tileRack&&e.gameBoard&&e.tileSpaces&&e.gameOpened))return null;var t=e.state.currentUser.user_id,r=e.state.currentUser.userKey;if(!t||!r)return null;var a,n=this,o=e.state.activeGame.props.id,s={game_id:o,user_id:t,userKey:r};window.fetch(e.gameServer+"opponent_status",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then((function(t){n.polled||e.UserStatus.getNotifications(),n.polled=!0,t.text().then((function(t){if(t.length){var r=JSON.parse(t);if(!r.game_id||r.game_id==o){var s,i=r.opponent_ready;a=JSON.parse(r.opponent_spaces);var l,c=!!r.started,p=r.turn,u=r.attacks,d=r.last_move?JSON.parse(r.last_move):{},f={};!d||!e.tileRack||e.tileRack.playerColor==d.color||n.state.last_move&&d.ts==n.state.last_move.ts||(f.last_move=d),l="blue"==e.tileRack.playerColor?"red":"blue",i!=n.state.players[l].ready&&((s=n.state.players)[l].ready=i,f.players=s),c!=n.state.started&&(f.started=c),p!=n.state.turn&&(f.turn=p);var m=n.state.players[l].soldiers;void 0!==m&&m==r.soldiers_remaining||((s=n.state.players)[l].soldiers=r.soldiers_remaining,f.players=s),Object.keys(f).length&&(n.setState(f),n.resetHelpText());var h=null;u!=n.state.attacks&&(h=JSON.parse(r.last_attack),e.gameOpened&&e.gameOpened<h.time&&(n.setState({attacks:u,last_attack:h}),e.gameBoard.openBattleModal(),e.gameBoard.getBattleContent(h)));var y,b,v=[],g=[];for(y in a)v.push(a[y].id);for(y in e.gameBoard.state.spaces)e.gameBoard.state.spaces[y].props.children&&e.gameBoard.state.spaces[y].props.children.props.color==l&&g.push(e.gameBoard.state.spaces[y].props.id);for(y in v)if(b=v[y],!g.includes(b)){var k={rank:null,color:l,tileSpace:null};e.gameBoard.placePiece(k,b,!0)}for(y in g)b=g[y],v.includes(b)||e.gameBoard.emptySpace(b)}}}))}))}},{key:"resetHelpText",value:function(){if(!this.state.started&&"click"==this.state.placementMode&&this.props.app.tileRack&&void 0!==this.HelpMessages)this.setHelpText(this.HelpMessages.clickSelected);else if(!this.state.started&&"erase"==this.state.placementMode&&this.props.app.tileRack&&void 0!==this.HelpMessages)this.setHelpText(this.HelpMessages.eraseSelected);else if(!this.state.started&&"quick"==this.state.placementMode&&this.props.app.tileRack&&void 0!==this.HelpMessages)this.setHelpText(this.HelpMessages.quickSelected);else if(this.state.started&&this.props.app.tileRack&&this.state.turn==this.props.app.tileRack.playerColor){var e;e=this.props.app.isMobile?this.props.app.gameBoard.selectedRank?"Tap a highlighted square to move the selected piece there":"Tap a "+this.props.app.tileRack.playerColor+" tile to select it.":"Drag & drop a "+this.props.app.tileRack.playerColor+" tile to make your move.",this.setHelpText(e)}else if(this.state.started&&this.props.app.tileRack&&this.state.turn!=this.props.app.tileRack.playerColor){var t="Waiting for "+("red"==this.state.turn?this.props.opponentName:this.props.starterName)+" to make a move.";this.setHelpText(t)}else this.setHelpText(null)}},{key:"componentDidMount",value:function(){this.HelpMessages={clickSelected:{headline:this.placementAction+" any "+this.props.app.tileRack.playerColor+" tile to select that piece.",subtext:!this.props.app.isMobile&&"You can also drag & drop tiles to rearrange them."},quickSelected:{headline:"Using a preset tile configuration.",subtext:!this.props.app.isMobile&&"You can drag & drop tiles to rearrange them."},keyboardSelected:{headline:"Use the arrow keys to choose a square.",subtext:"Type rank (1-9, S, F, B) to place a piece, or X to erase."},eraseSelected:this.placementAction+" a "+this.props.app.tileRack.playerColor+" tile on the board to return it to the rack"},this.props.app.gameRef=this,this.opponentPoll=setInterval(this.pollOpponentStatus,3e3),this.resetHelpText()}},{key:"clearCaptured",value:function(){this.setState({captured:{blue:{},red:{}}})}},{key:"addCaptured",value:function(e,t){var r=this.state.captured,n=1;r[e.color][e.rank]&&(n=r[e.color][e.rank].props.count+1),r[e.color][e.rank]=a.createElement(H.Z,{color:e.color,rank:e.rank,captured:!0,game:this,count:n,key:e.color+"-"+e.rank,extraClass:"w-50 d-inline-block mb-2"}),t?this.state.captured=r:this.setState({captured:r})}},{key:"startGame",value:function(){var e=this.props.app,t=this.props.app.gameBoard;t.selectSpace(null),t.highlightSpace(null),this.setState({started:!0});var r=0==Math.floor(2*Math.random())?"red":"blue";e.gameStates[this.props.id].started=!0,e.gameStates[this.props.id].turn=r,e.saveActiveGame()}},{key:"toggleTurn",value:function(){var e;e="blue"==this.state.turn?"red":"blue",this.setState({turn:e})}},{key:"closeHelpBar",value:function(){this.setState({helpBarMinimized:!0})}},{key:"openHelpBar",value:function(){this.setState({helpBarMinimized:!1})}},{key:"modeChange",value:function(e){this.setState({placementMode:e}),"keyboard"==e?this.props.app.gameBoard.selectSpace(1):(this.props.app.gameBoard.selectSpace(null),this.props.app.gameBoard.highlightSpace(null)),"quick"!=e&&(this.props.app.gameBoard.QuickLoadMenu.previousMode=e),void 0!==this.HelpMessages&&this.setHelpText(this.HelpMessages[e+"Selected"])}},{key:"openQuickLoadModal",value:function(){this.props.app.gameBoard.QuickLoadMenu.setState({formOpen:!0})}},{key:"componentWillUnmount",value:function(){clearInterval(this.opponentPoll);var e=this.props.app;e.gameRef=null,e.gameOpened=!1}},{key:"render",value:function(){var e=this.props.app;(0,s.fF)("Game rendering"),this.props.id&&(e.gameStates[this.props.id]=this.state);var t=parseInt(e.state.currentUser.user_id)==parseInt(this.props.starter)?"blue":"red",r="mx-auto player-"+t;this.state.started&&(this.state.turn&&this.state.status&&"done"!=this.state.status&&(r+=" turn-"+this.state.turn),r+=" started"),this.state.helpBarMinimized&&(r+=" help-bar-minimized");var n={backends:[{backend:A.ZP},{backend:Y.z}]};return a.createElement(U.Z,{className:r},a.createElement(Z.W,{backend:X.ZP,options:n},a.createElement(O.Z,{noGutters:!0},a.createElement(G.default,{game:this,app:e,playerColor:t}),a.createElement(F.Z,{xs:{span:12,order:2},sm:8,lg:{span:9,order:1},xl:8,className:"mx-auto px-0 scroll"},a.createElement(D,{game:this,app:e})))))}}])&&J(t.prototype,r),n&&J(t,n),p}(a.Component)}}]);